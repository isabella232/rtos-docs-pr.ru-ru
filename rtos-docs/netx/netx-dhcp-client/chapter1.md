---
title: Глава 1. Введение в клиент ОСРВ Azure NetX DHCP
description: В NetX IP-адрес приложения является одним параметров, указываемых в вызове функции nx_ip_create.
author: philmea
ms.author: philmea
ms.date: 06/04/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: 44eb764c84a15a1bc96cf94bcbc8f81be7b41eef
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/22/2021
ms.locfileid: "104815256"
---
# <a name="chapter-1---introduction-to-azure-rtos-netx-dhcp-client"></a>Глава 1. Введение в клиент ОСРВ Azure NetX DHCP

В NetX IP-адрес приложения является одним параметров, указываемых в вызове функции *nx_ip_create*. Предоставление IP-адреса не вызывает проблем, если этот IP-адрес известен приложению, то есть назначен статически или посредством конфигурации пользователя. Однако существуют ситуации, в которых приложение не знает своего IP-адреса или он не важен. В таких ситуациях необходимо передать нулевой IP-адрес в функцию *nx_ip_create* и использовать протокол клиента ОСРВ Azure DHCP для динамического получения IP-адреса.

## <a name="dynamic-ip-address-assignment"></a>Динамическое назначение IP-адресов

Основной службой, используемой для получения динамического IP-адреса из сети, является протокол RARP. Этот протокол аналогичен протоколу ARP, за исключением того, что он предназначен для получения IP-адреса для себя, а не для поиска MAC-адреса для другого сетевого узла. Сообщение низкого уровня RARP транслируется по локальной сети, и сервер в этой сети обязан отправить ответ RARP, который содержит динамически выделенный IP-адрес.

Хотя протокол RARP предоставляет службу для динамического выделения IP-адресов, у него есть несколько недостатков. Самый очевидный недостаток заключается в том, что протокол RARP обеспечивает динамическое выделение только IP-адреса. В большинстве случаев для того, чтобы устройство правильно работало в сети, требуется дополнительная информация. В дополнение к IP-адресу большинству устройств требуется маска сети и IP-адрес шлюза. Может также потребоваться IP-адрес DNS-сервера и другие сведения о сети. Протокол RARP не может предоставить эти сведения.

## <a name="rarp-alternatives"></a>Альтернативы протоколу RARP

Чтобы преодолеть недостатки протокола RARP, исследователи разработали более полный механизм выделения IP-адресов, называемый протоколом начальной загрузки (BOOTP). Этот протокол может динамически выделять IP-адреса, а также предоставлять важные дополнительные сведения о сети. Тем не менее, недостаток протокола BOOTP заключается в том, что он разработан для статических сетевых конфигураций. Он не позволяет быстро или автоматически назначать адреса.

Именно здесь может оказаться очень полезным протокол DHCP. Протокол DHCP предназначен расширить основные функции BOOTP, включая полностью автоматизированное выделение IP-серверов и полностью динамическое выделение IP-адресов путем "аренды" IP-адреса клиенту на указанный период времени. Протокол DHCP можно также настроить для статического выделения IP-адресов, как в протоколе BOOTP.

## <a name="dhcp-messages"></a>Сообщения DHCP

Хотя протокол DHCP значительно расширяет функции протокола BOOTP, в DHCP используется тот же формат сообщений, что и в BOOTP, и поддерживаются те же варианты поставщиков, что и в BOOTP. Для выполнения функций в протокол DHCP добавлены семь новых параметров, относящихся к DHCP:

- DISCOVER (1) (отправляется DHCP-клиентом);

- OFFER (2) (отправляется DHCP-сервером);

- DISCOVER (3) (отправляется DHCP-клиентом);

- DECLINE (4) (отправляется DHCP-клиентом);

- ACK (5) (отправляется DHCP-сервером);

- NACK (6) (отправляется DHCP-сервером);

- RELEASE (7) (отправляется DHCP-клиентом);

- INFORM (8) (отправляется DHCP-клиентом);

- FORCERENEW (9) (отправляется DHCP-клиентом).

## <a name="dhcp-communication"></a>Взаимодействие по протоколу DHCP

Протокол DHCP использует протокол UDP для отправки запросов и ответных значений полей. Перед получением IP-адреса выполняются отправка и получение сообщений UDP, в которых хранятся данные DHCP, с помощью широковещательного IP-адреса 255.255.255.255.

## <a name="dhcp-client-state-machine"></a>Конечный автомат DHCP-клиента

DHCP-клиент реализуется как конечный автомат. Конечный автомат обрабатывается внутренним потоком DHCP, который создается во время обработки вызова *nx_dhcp_create*. Ниже приведены основные состояния DHCP-клиента.


- **NX_DHCP_STATE_BOOT**: запуск с предыдущим IP-адресом.

- **NX_DHCP_STATE_INIT**: запуск без предыдущего IP-адреса.

- **NX_DHCP_STATE_SELECTING**: ожидание ответа от любого DHCP-сервера.

- **NX_DHCP_STATE_REQUESTING**: DHCP-сервер определен, отправлен запрос IP-адреса.

- **NX_DHCP_STATE_BOUND**: установлена аренда IP-адреса DHCP.

- **NX_DHCP_STATE_RENEWING**: пришло время продления аренды IP-адреса DHCP, запрошено продление.

- **NX_DHCP_STATE_REBINDING**: пришло время повторной привязки для аренды IP-адреса DHCP, запрошено продление.

- **NX_DHCP_STATE_FORCERENEW**: установлена аренда IP-адреса DHCP и выполнено принудительное продление сервером (в настоящее время не поддерживается) или приложением (посредством вызова nx_dhcp_force_renew).

- **NX_DHCP_STATE_ADDRESS_PROBING**: на IP-адрес DHCP отправлена проба ARP для обнаружения конфликта IP-адресов.

## <a name="dhcp-client-multiple-interface-support"></a>Поддержка нескольких интерфейсов для DHCP-клиента

Ранее DHCP-клиент был реализован для запуска только на одном сетевом интерфейсе. По умолчанию DHCP-клиент запускался (и сейчас запускается) на основном интерфейсе. Вызвав службу *nx_dhcp_set_interface_index*, приложение могло (и по-прежнему может) запустить DHCP на дополнительном сетевом интерфейсе, а не на основном интерфейсе.

Теперь поддерживается параллельное выполнение протокола DHCP на нескольких интерфейсах. Дополнительные сведения о том, как запустить DHCP-клиент на нескольких физических интерфейсах одновременно, см. в разделе **Одновременный запуск DHCP-клиента на нескольких интерфейсах** главы 2.

## <a name="dhcp-user-request"></a>Запрос пользователя DHCP

После того как DHCP-сервер предоставит адрес, для обработки DHCP-клиента могут запрашиваться дополнительные параметры (по одному) с помощью службы *nx_dhcp_user_option_request*.

## <a name="dhcp-client-socket-queue"></a>Очередь сокета DHCP-клиента 

Ожидая ответа сервера, DHCP-клиент автоматически удаляет широковещательные пакеты от DHCP-серверов, предназначенные для других DHCP-клиентов, из очереди получения сокета. Если этого не делать, то в нагруженной сети это может привести к удалению пакетов, предназначенных для клиента.

## <a name="dhcp-rfcs"></a>Документы RFC, которым соответствует протокол DHCP

Протокол NetX DHCP соответствует RFC 2132, RFC 2131 и связанным документам RFC.

