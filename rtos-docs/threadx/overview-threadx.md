---
title: Общие сведения о ОСРВ Azure ThreadX
description: Azure ThreadX — это усовершенствованная операционная система реального времени (ОСРВ), разработанная специально для глубоко встраиваемых приложений.
author: philmea
ms.author: philmea
ms.date: 6/9/2020
ms.service: rtos
ms.topic: overview
ms.openlocfilehash: 938619170ef51d354fa970134328c17407ae846a
ms.sourcegitcommit: dbbec3ba6a7eb6097c7888b235c433a2efd6e5b9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/14/2021
ms.locfileid: "113754868"
---
# <a name="overview-of-azure-rtos-threadx"></a>Обзор ОСРВ Azure ThreadX

ОСРВ Azure ThreadX — это усовершенствованная промышленная операционная система реального времени (ОСРВ), разработанная корпорацией Майкрософт специально для глубоко встраиваемых приложений IoT реального времени. ОСРВ Azure ThreadX предоставляет возможности расширенного планирования, обмен данными, синхронизацию, таймеры, управление памятью и управление прерываниями. Кроме того, в Azure RTO ThreadX реализовано множество дополнительных функций, включая архитектуру picokernel™, технологию планирования preemption-threshold™, технологию event-chaining™, профилирование выполнения, метрики производительности и трассировку системных событий. Благодаря чрезвычайной простоте использования ОСРВ Azure ThreadX является идеальным выбором для самых требовательных внедренных приложений. Начиная с 2017 года было развернуто более 6 200 000 000 экземпляров ОСРВ Azure ThreadX в самых разных продуктах, включая потребительские устройства, медицинские электронные устройства и оборудование для управления производством.

## <a name="api-protocols"></a>Протоколы API

### <a name="azure-rtos-threadx-services"></a>Службы ОСРВ Azure ThreadX

* Динамическое создание потоков.
* Неограниченное число потоков.
* Основные API потоков:
  * tx_thread_create
  * tx_thread_delete
  * tx_thread_preemption_change
  * tx_thread_priority_change
  * tx_thread_relinquish
  * tx_thread_reset
  * tx_thread_resume
  * tx_thread_sleep
  * tx_thread_suspend
  * tx_thread_terminate
  * tx_thread_wait_abort
* Интерфейсы API для получения дополнительных сведений и данных о производительности.

### <a name="message-queues"></a>Очереди сообщений

* Динамическое создание очередей.
* Неограниченное число очередей.
* Сообщения копируются по значению (или по ссылке через указатель).
* Размер сообщений от 1 до 16 32-разрядных слов.
* Необязательная приостановка потоков при пустой и переполненной очереди.
* Необязательное время ожидания при всех приостановках.
* Основные API очереди сообщений:
  * tx_queue_create
  * tx_queue_delete
  * tx_queue_flush
  * tx_queue_front_send
  * tx_queue_receive
  * tx_queue_send_notify
* Интерфейсы API для получения дополнительных сведений и данных о производительности.

### <a name="counting-semaphores"></a>Семафоры со счетчиком

* Динамическое создание семафоров.
* Неограниченное число семафоров.
* 32-разрядные семафоры со счетчиком (от 0 до 4 294 967 295).
* Поддержка схемы "производитель — получатель" и защиты ресурсов.
* Необязательная приостановка потоков при недоступности семафора.
* Необязательное время ожидания при всех приостановках.
* Основные API семафоров:
  * tx_semaphore_create
  * tx_semaphore_delete
  * tx_semaphore_get
  * tx_semaphore_put
  * tx_semaphore_put_notify
* Интерфейсы API для получения дополнительных сведений и данных о производительности.

### <a name="mutexes"></a>Mutexes

* Динамическое создание мьютексов.
* Неограниченное число мьютексов.
* Поддержка защиты вложенных ресурсов.
* Поддержка необязательного наследования приоритета.
* Необязательная приостановка потоков при недоступности мьютекса.
* Необязательное время ожидания при всех приостановках.
* Основные API мьютексов:
  * tx_mutex_create
  * tx_mutex_delete
  * tx_mutex_get
  * tx_mutex_put
* Интерфейсы API для получения дополнительных сведений и данных о производительности.

### <a name="event-flags"></a>Флаги событий

* Динамическое создание группы флагов событий.
* Неограниченное количество групп флагов событий.
* Синхронизация одного или нескольких потоков.
* Поддержка атомарных операций get и clear.
* Необязательная приостановка нескольких потоков для набора событий с логическими условиями (И, ИЛИ).
* Необязательное время ожидания при всех приостановках.
* Основные API флагов событий:
  * tx_event_flags_create
  * tx_event_flags_delete
  * tx_event_flags_get
  * tx_event_flags_set
  * tx_event_flags_set_notify
* Интерфейсы API для получения дополнительных сведений и данных о производительности.

### <a name="block-memory-pools"></a>Пулы блоков памяти

* Динамическое создание пулов блоков.
* Неограниченное количество пулов блоков.
* Неограниченный размер блоков фиксированного размера или пулов.
* Максимально быстрое выделение и освобождение памяти.
* Необязательная приостановка потоков при пустом пуле.
* Необязательное время ожидания при всех приостановках.
* Основные API пула блоков:
  * tx_block_pool_create
  * tx_block_pool_delete
  * tx_block_allocate
  * tx_block_release
* Интерфейсы API для получения дополнительных сведений и данных о производительности.

### <a name="byte-memory-pools"></a>Пулы байтов памяти

* Динамическое создание пулов байтов.
* Неограниченное количество пулов байтов.
* Неограниченный размер пула байтов.
* Наиболее гибкое выделение и освобождение областей памяти переменной длины.
* Поддержка сосредоточения выделяемой области.
* Необязательная приостановка потоков при пустом пуле.
* Необязательное время ожидания при всех приостановках.
* Основные API пула байтов:
  * tx_byte_pool_create
  * tx_byte_pool_delete
  * tx_byte_allocate
  * tx_byte_release
* Интерфейсы API для получения дополнительных сведений и данных о производительности.

### <a name="application-timers"></a>Таймеры приложения

* Динамическое создание таймеров.
* Неограниченное число таймеров.
* Поддержка периодических или одноразовых таймеров.
* Периодические таймеры могут иметь разные начальные значения срока действия.
* Отсутствие поиска по активации или деактивации таймеров.
* Всеми таймерами управляет одно прерывание аппаратного таймера.
* Основные API таймеров:
  * tx_timer_create
  * tx_timer_delete
  * tx_timer_activate
  * tx_timer_change
  * tx_timer_deactivate
* Интерфейсы API для получения дополнительных сведений и данных о производительности.

### <a name="azure-rtos-threadx-core-scheduler"></a>Базовый планировщик ОСРВ Azure ThreadX

* Минимальная занимаемая память: 2 КБ флэш-памяти и 1 КБ ОЗУ.
* Быстрое переключение контекста меньше чем за микросекунду.
* Полностью детерминированная платформа независимо от количества потоков.
* Планирование с полным вытеснением на основе приоритета.
* 32 уровней приоритета по умолчанию (при необходимости можно использовать до 1024 уровней).
* Координированное планирование на уровне приоритета (FIFO).
* Технология preemption-threshold.
* Необязательные службы таймеров, включая:
  * создание временных срезов для потоков;
  * задание времени ожидания для всех блокировок;
  * для интерфейсов API требуется прерывание аппаратного таймера.
* Профилирование выполнения.
* Трассировка на уровне системы.
* Сертифицированная безопасность, соответствующая множеству стандартов.

## <a name="threadx-footprint"></a>Объем памяти ThreadX

ОСРВ Azure ThreadX требуется очень мало занимаемой памяти — всего 2 КБ области инструкций и 1 КБ ОЗУ. В основном это обусловлено одноуровневой архитектурой picokernel™ и автоматическим масштабированием. Автоматическое масштабирование означает, что во время компоновки в окончательный образ добавляются только службы (и поддерживающая инфраструктура), используемые приложением.

Ниже приведены типичные размеры для ОСРВ Azure ThreadX.

|Служба ОСРВ Azure ThreadX  |Типичный размер в байтах  |
|---------|---------|
|Основные службы (обязательные) |2 000  |
|Службы очередей  |900  |
|Службы флагов событий  |900  |
|Службы семафоров  |450  |
|Службы мьютексов  |1200  |
|Службы блоков памяти  |550  |
|Службы управления байтами памяти  |900  |

## <a name="threadx-execution-speed"></a>Скорость выполнения ThreadX

ОСРВ Azure ThreadX достигает переключения контекста меньше чем за микросекунду на самых популярных процессорах, значительно опережая другие коммерческие ОСРВ по этому параметру. В дополнение к быстроте ОСРВ Azure ThreadX также является высокодетерминированной. Она обеспечивает одинаковую производительность как для 200 потоков, так и для 1 потока.

Ниже приведены типичные характеристики производительности ОСРВ Azure ThreadX.

* Быстрая загрузка: ОСРВ Azure ThreadX загружается менее чем за 120 циклов.
* Необязательное отключение базовой проверки на ошибки: базовая проверка на ошибки ОСРВ Azure ThreadX может быть пропущена во время компиляции. Это может быть удобно, когда код приложения проверен и больше не требует проверки на наличие ошибок для каждого параметра. Обратите внимание на то, что это можно сделать на уровне компилируемого модуля, а не всей системы.
* Структура picokernel™: службы не размещаются на разных уровнях, что устраняет ненужные временные затраты при вызове функций.
* \* Оптимизированная обработка прерываний: только временные регистры сохраняются или восстанавливаются при входе в подпрограммы ISR и выходе из них, если только не требуется вытеснение.
* Оптимизированная обработка API.

    |Служба ОСРВ Azure ThreadX  |Время работы службы в микросекундах*  |
    |---------|---------|
    |Приостановка потока  |0,6  |
    |Возобновление потока  |0,6  |
    |Отправка в очередь  |0,3  |
    |Получение в очередь  |0,3  |
    |Получение семафора  |0,2  |
    |Задание семафора  |0,2  |
    |Переключение контекста  |0,4  |
    |Реагирование на прерывание  |0,0–0,6  |

    **Показатели производительности приведены для типичного процессора с частотой 200 МГц*.

## <a name="advanced-technology"></a>Усовершенствованные технологии

ОСРВ Azure ThreadX — это усовершенствованная технология, наиболее важная функция которой — планирование с порогом вытеснения. Это уникальная функция ОСРВ Azure ThreadX, которая была предметом обширных научных исследований. Например, ознакомьтесь со статьей [Scheduling Fixed-Priority Tasks with Preemption Threshold](https://www.cs.utah.edu/~regehr/reading/open_papers/preempt_thresh.pdf) (Планирование задач с фиксированным приоритетом с использованием порога вытеснения), написанной Юнь Ванем, Университет Конкордия, и Манасом Саксеной, 
Питтсбургский Университет.

Рассмотрим возможности ОСРВ Azure ThreadX.

* Полные и исчерпывающие средства многозадачности:
  * потоки, таймеры приложения, очереди сообщений, семафоры со счетчиком, мьютексы, флаги событий, пулы блоков и байтов памяти.
* Планирование с вытеснением на основе приоритета.
* Гибкость приоритетов — до 1024 уровней приоритета.
* Координированное планирование.
* Preemption-threshold™ — уникальная технология ОСРВ Azure ThreadX, которая помогает сократить число переключений контекста и обеспечить применение расписаний (согласно научным исследованиям).
* Защита памяти с помощью модулей ОСРВ Azure ThreadX.
* Полностью детерминированные операции.
* Трассировка событий — запись *n* последних событий системы или приложения.
* Технология event-chaining™ позволяет зарегистрировать функцию обратного вызова уведомления, зависящую от приложения, для каждого объекта связи или синхронизации ОСРВ Azure ThreadX.
* Модули ОСРВ Azure ThreadX с необязательной защитой памяти.
* Метрики производительности времени выполнения:
  * число возобновлений потоков;
  * число приостановок потоков;
  * число запрошенных вытеснений потоков;
  * число асинхронных прерываний с вытеснением потоков;
  * число инверсий приоритета потоков;
  * число освобождений потоков.
* Набор профилей выполнения (EPK).
* Отдельный с стек прерываний.
* Анализ стека во время выполнения.
* Оптимизированная обработка прерываний таймера.

## <a name="multicore-support-amp--smp"></a>Поддержка многоядерных платформ (AMP и SMP)

Стандартная ОСРВ Azure ThreadX часто используется для асимметричной многопроцессорной обработки (AMP), где отдельная копия ОСРВ Azure ThreadX и приложение (или ОС Linux) выполняются на каждом ядре и взаимодействуют друг с другом через общую память либо какой-либо механизм межпроцессорного взаимодействия, например OpenAMP (ОСРВ Azure ThreadX поддерживает OpenAMP). Это самая типичная многоядерная конфигурация на основе ОСРВ Azure ThreadX, которая будет наиболее производительной, если приложение сможет эффективно загружать все процессоры.

Для сред, в которых загрузка процессоров отличается высокой динамичностью, доступна ОСРВ Azure ThreadX Symetric Multiprocessing (SMP) для симметричной многопроцессорной обработки, поддерживающая следующие семейства процессоров:

* ARM Cortex-Ax;
* ARM Cortex-Rx;
* ARM Cortex-A5x (64-разрядные версии);
* MIPS 34K, 1004K и interAptiv;
* PowerPC;
* Synopsys ARC HS;
* x86.

ОСРВ Azure ThreadX SMP выполняет динамическую балансировку нагрузки для *n* процессоров и позволяет любому потоку на любом ядре обращаться ко всем ресурсам ОСРВ Azure ThreadX (очереди, семафоры, флаги событий, пулы памяти и т. д.). ОСРВ Azure ThreadX SMP обеспечивает полный набор API ОСРВ Azure ThreadX на всех ядрах и предоставляет следующие новые API, предназначенные для операций SMP:

* `UINT tx_thread_smp_core_exclude(TX_THREAD *thread_ptr, ULONG exclusion_map);`
* `UINT tx_thread_smp_core_exclude_get(TX_THREAD *thread_ptr, ULONG *exclusion_map_ptr);`
* `UINT tx_thread_smp_core_get(void);`
* `UINT tx_timer_smp_core_exclude(TX_TIMER *timer_ptr, ULONG exclusion_map);`
* `UINT tx_timer_smp_core_exclude_get(TX_TIMER *timer_ptr, ULONG *exclusion_map_ptr);`

## <a name="memory-protection-via-azure-rtos-threadx-modules"></a>Защита памяти с помощью модулей ОСРВ Azure ThreadX

Дополнительный продукт, называемый модулями ОСРВ Azure ThreadX, позволяет объединить один или несколько потоков приложения в модуль, который можно загружать динамически и запускать (или выполнять на месте) на целевом оборудовании.

Модули позволяют выполнять обновление на месте, устранять ошибки и секционировать программы, чтобы большие приложения занимали только тот объем памяти, который необходимым для активных потоков.

Модули также используют адресное пространство, отдельное от ОСРВ Azure ThreadX. Это позволяет ОСРВ Azure ThreadX применять защиту памяти (посредством MPU или MMU) для модуля, которая не позволяет непреднамеренному обращению извне модуля повредить какой-либо другой программный компонент.

## <a name="misra-compliant"></a>Соответствие требованиям MISRA

Исходный код ОСРВ Azure ThreadX и ОСРВ Azure ThreadX SMP соответствует требованиям MISRA-C:2004 и MISRA C:2012. MISRA C — это набор руководств по программированию критических систем с использованием языка программирования C. Первоначальные рекомендации MISRA C главным образом были нацелены на приложения для автомобилестроения, но теперь MISRA C широко признается стандартом, применимым к любому приложению со строгими требованиями к безопасности. ОСРВ Azure SMP ThreadX соответствует всем требуемым и обязательным правилам стандартов MISRA-C:2004 и MISRA C:2012.

:::image type="content" source="media/overview-threadx/misra-logo-certification.png" alt-text="Сертификация MISRA":::

## <a name="supports-most-popular-tools"></a>Поддержка большинства популярных инструментов

ОСРВ Azure ThreadX поддерживает большинство популярных внедренных инструментов разработки, включая решение Embedded Workbench™ от IAR, которое также лучше всего совместимо с ядром ОСРВ Azure ThreadX. Возможна интеграция с дополнительными средства, включая инструменты GNU (GCC), ARM DS-5/uVision®, Green Hills MULTI®, Wind River Workbench™, Imagination Codescape, Renesas e2studio, Metaware SeeCode™, NXP CodeWarrior, Lauterbach TRACE32®, TI Code-Composer Studio, CrossCore и все аналоговые устройства.

## <a name="adaptation-layer-for-threadx"></a>Уровень адаптации для ThreadX

ОСРВ Azure ThreadX — это усовершенствованная операционная система реального времени (ОСРВ), разработанная специально для глубоко встраиваемых приложений. Чтобы упростить миграцию приложений на Auzre RTO, ThreadX предоставляет [уровни адаптации](https://github.com/azure-rtos/threadx/tree/master/utility/rtos_compatibility_layers) для разных API RTO устаревших версий (FreeRTOS, POSIX, OSEK и т. д.).
