---
title: Глава 2. Установка и использование NetX Duo в ОСРВ Azure
description: В этой главе описаны различные проблемы, связанные с установкой, настройкой и использованием высокопроизводительного сетевого стека NetX Duo в ОСРВ Azure.
author: philmea
ms.author: philmea
ms.date: 05/19/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: 8ee9d16c71d6c207de2098d688d49e6482c8b780
ms.sourcegitcommit: 60ad844b58639d88830f2660ab0c4ff86b92c10f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/07/2021
ms.locfileid: "106550156"
---
# <a name="chapter-2---installation-and-use-of-azure-rtos-netx-duo"></a>Глава 2. Установка и использование NetX Duo в ОСРВ Azure

В этой главе описаны различные проблемы, связанные с установкой, настройкой и использованием высокопроизводительного сетевого стека NetX Duo в ОСРВ Azure, включая следующее: 

## <a name="host-considerations"></a>Рекомендации по размещению

Разработка внедряемых решений обычно выполняется на главных компьютерах Windows или Linux (Unix). После компиляции приложения, его связывания и создания исполняемого файла на узле приложение загружается на целевое оборудование для выполнения.

Как правило, загрузка на целевой объект запускается из отладчика инструмента для разработки. После загрузки отладчик отвечает за управление выполнением на целевом объекте (запуск, остановка, точка останова и т. д.), а также за доступ к памяти и регистрам процессора.

Большинство отладчиков инструментов разработки обмениваются данными с целевым оборудованием через подключения OCD (отладка на микросхеме), например JTAG (IEEE 1149.1) и BDM (режим фоновой отладки). Кроме того, отладчики взаимодействуют с целевым оборудованием через подключения ICE (внутрисхемная эмуляция). Подключения OCD и ICE обеспечивают надежную передачу данных с минимальным влиянием на резидентное ПО на целевом объекте.

Как и в случае с ресурсами, используемыми на узле, исходный код для NetX Duo предоставляется в формате ASCII и требует около 1 МБ свободного пространства на жестком диске компьютера узла.

## <a name="target-considerations"></a>Рекомендации по целевому оборудованию

NetX Duo требует от 5 до 45 КБ доступной только для чтения памяти в целевой системе. Еще 1–5 КБ ОЗУ целевого объекта необходимо для стека потока NetX Duo и других глобальных структур данных.

Кроме того, для NetX Duo нужно обеспечить использование двух объектов таймера ThreadX и одного объекта мьютекса ThreadX. Эти средства используются для периодической обработки и защиты потоков в стеке протоколов NetX Duo.

## <a name="product-distribution"></a>Распространение продукта

NetX Duo для ОСРВ Azure можно получить из нашего общедоступного репозитория исходного кода по адресу <https://github.com/azure-rtos/netxduo/>.

Ниже приведен список основных файлов в этом репозитории.

**nx_api.h**  
Файл заголовка на C включает все системные равенства, структуры данных и прототипы служб.

**nx_port.h**: файл заголовка на C включает в себя все определения и структуры данных для средств разработки и целевой системы. 

**demo_netx.c**: файл на C, содержащий небольшое демонстрационное приложение.

**nx.a (или nx.lib)**  
Двоичная версия библиотеки NetX для C, распространяемая со стандартным пакетом.

## <a name="netx-duo-installation"></a>Установка NetX Duo

NetX Duo устанавливается путем клонирования репозитория GitHub на локальный компьютер. Ниже приведен типичный синтаксис для создания клона репозитория NetX Duo на вашем компьютере.

```c
    git clone https://github.com/azure-rtos/netxduo
```

Вы также можете скачать копию репозитория с помощью соответствующей кнопки на главной странице GitHub.

Кроме того, вы можете найти инструкции по созданию библиотеки NetX Duo на главной странице веб-репозитория.

> [!IMPORTANT]
> *Программному обеспечению приложений требуется доступ к файлу библиотеки NetX Duo, (который обычно имеет имя **nx.a** или **nx.lib**), а также к включаемым файлам на C **nx_api.h и nx_port.h**. Это можно реализовать, задав соответствующий путь в инструментах разработки или скопировав такие файлы в область разработки приложения.*

## <a name="using-netx-duo"></a>Использование NetX Duo

Использовать NetX Duo очень просто. В основном, чтобы использовать NetX, код приложения должен содержать ***nx_api.h** _ во время компиляции и связь с библиотекой NetX Duo _*_nx.a_*_ (или _ *_nx.lib_*)*.

Ниже приведены четыре простых шага, которые необходимо выполнить для создания приложения NetX Duo.

[!div class="mx-tdCol2BreakAll"]

| Шаг  | Описание  |
|---|---|
|Шаг&nbsp;1. |Добавьте файл ***nx_api.h*** во все файлы приложения, которые используют службы или структуры данных NetX Duo.|
|Шаг&nbsp;2. |Инициализируйте систему NetX Duo, вызвав ***nx_system_initialize** _ из функции _ *_tx_application_define_** или потока приложения.|
|Шаг&nbsp;3. |Создайте экземпляр IP, включите протокол ARP (при необходимости) и все необходимые сокеты после вызова ***nx_system_initialize***.|
|Шаг&nbsp;4. |Выполните компиляцию исходного кода и свяжите его с библиотекой среды выполнения NetX Duo ***nx.a** _ (или _*_nx.lib_**). Полученный образ можно загрузить в целевую систему и запустить.|

## <a name="troubleshooting"></a>Устранение неполадок

Каждый порт NetX Duo поставляется с одной или несколькими демонстрациями, которые выполняются в реальной сети или через смоделированный сетевой драйвер. Первой рекомендуется запускать именно демонстрационную систему.

Если демонстрационная система не работает надлежащим образом, выполните следующие операции, чтобы определить проблему:

1. Определите, на каком этапе демонстрации возникает ошибка.
2. Увеличьте размеры стека во всех новых потоках приложения.
3. Повторно выполните компиляцию библиотеки NetX Duo с соответствующими параметрами отладки, которые приведены в разделе параметров конфигурации.
4. Изучите структуру NX_IP, чтобы узнать, возможны ли отправка или получение пакетов.
5. Изучите пул пакетов по умолчанию, чтобы проверить его на наличие доступных пакетов.
6. Убедитесь, что сетевой драйвер предоставляет пакеты ARP и IP с заголовками на 4-байтовых границах для приложений, которым требуются подключения IPv4 или IPv6.
7. Временно обойдите все недавние изменения, чтобы понять, как при этом меняется проблема. Такая информация будет полезной специалистам службы поддержки Майкрософт.

Выполните инструкции, приведенные в разделе "Что нам нужно" на стр. 12, чтобы отправить информацию, собранную на этапе устранения неполадок.

## <a name="configuration-options"></a>Параметры конфигурации

При сборке библиотеки NetX Duo и приложения, использующего NetX Duo, доступны несколько параметров конфигурации. Параметры конфигурации можно определить в исходном коде приложения, в командной строке или во включаемом файле ***nx_user.h***, если не заданы другие варианты.

> [!NOTE]
> *Определенные в файле **nx_user.h** параметры применяются только в случае сборки приложения и библиотеки NetX Duo с определенным параметром* **NX_INCLUDE_USER_DEFINE_FILE***.

В следующих разделах приведены параметры конфигурации, доступные в NetX Duo. Вначале перечислены общие параметры, применимые как для IPv4, так и для IPv6, а затем варианты, относящиеся конкретно к IPv6.

### <a name="system-configuration-options"></a>Параметры конфигурации системы

| Параметр  | Описание  |
|---|---|
| NX_ASSERT_FAIL    | Символ, определяющий оператор отладки, который следует использовать в случае сбоя утверждения.                               |
| NX_DEBUG           | Если определен, этот параметр позволяет выполнить вывод дополнительных сведений об отладке, доступных из сетевого драйвера Ethernet в ОЗУ. |
| NX_DEBUG_PACKET   | Если определен, этот параметр позволяет выполнить дамп дополнительного пакета отладки, доступного из сетевого драйвера Ethernet в ОЗУ.      |
| NX_DISABLE_ASSERT | Если определен, этот параметр позволяет отключить проверку ASSERT в исходном коде. По умолчанию этот параметр не определен.            |
|NX_DISABLE_ERROR_CHECKING | Если определен, этот параметр отключает API проверки NetX Duo на наличие ошибок и повышает производительность. Коды возврата API, которые не затрагиваются при отключении проверки на ошибки, выделены полужирным шрифтом в определении API. Это определение обычно используется после достаточной отладки приложения. Его применение повышает производительность и уменьшает размер кода.|
|NX_DRIVER_DEFERRED_PROCESSING | Если определен, этот параметр включает отложенную обработку пакетов сетевого драйвера. Это позволяет сетевому драйверу разместить пакет в экземпляре IP и вызвать реальную подпрограмму обработки из внутреннего вспомогательного потока IP NetX Duo.|
|NX_DUAL_PACKET_POOL_ENABLE | Переименован в ***NX_ENABLE_DUAL_PACKET_POOL** _. Хотя этот параметр по-прежнему поддерживается, в новых проектах рекомендуется использовать _*_NX_ENABLE_DUAL_PACKET_POOL_**.|
|NX_ENABLE_DUAL_PACKET_POOL | Если определен, этот параметр позволяет стеку использовать два пула пакетов: один с большим размером полезных данных, а другой — с меньшим. По умолчанию этот параметр отключен.|
|NX_ENABLE_EXTENDED_NOTIFY_SUPPORT| Если определен, этот параметр включает дополнительные обработчики обратного вызова в стеке. Эти функции обратного вызова используются на уровне оболочки BSD. По умолчанию этот параметр не определен.|
|NX_ENABLE_INTERFACE_CAPABILITY| Если определен, этот параметр позволяет драйверу устройства интерфейса указывать дополнительные сведения о возможностях, таких как разгрузка контрольной суммы. По умолчанию этот параметр не определен.|
|NX_ENABLE_SOURCE_ADDRESS_CHECK| Если определен, этот параметр включает проверку адреса источника входящего пакета. Этот параметр по умолчанию отключен.|
| NX_IPSEC_ENABLE  | Если определен, этот параметр включает библиотеку NetX Duo, чтобы обеспечить поддержку операций IPsec. Для этой возможности требуется дополнительный модуль IPsec NetX Duo. По умолчанию эта возможность отключена.            |
| NX_LITTLE_ENDIAN | Если определен, этот параметр выполняет необходимую перестановку байтов в средах с прямым порядком байтов, чтобы гарантировать, что для заголовков протокола будет задан правильный формат с прямым порядком байтов. Обратите внимание, что значение по умолчанию обычно устанавливается в ***nx_port.h***.|
|NX_MAX_PHYSICAL_INTERFACES | Указывает общее число физических сетевых интерфейсов на устройстве. Значение по умолчанию равно 1 и определено в ***nx_api.h***; устройство должно иметь по крайней мере один физический интерфейс. Обратите внимание, что в это число не входит интерфейс замыкания на себя.|
| NX_NAT_ENABLE | Если определен, этот параметр предполагает создание NetX Duo с помощью процесса NAT. По умолчанию этот параметр не определен.|
| NX_PHYSICAL_HEADER  | Задает размер физического заголовка кадра в байтах. Значение по умолчанию равно 16 (на основе типичного 14-байтового кадра Ethernet, выравниваемого по 32-битной границе) и определяется в ***nx_api.h** _. Приложение может переопределить значение по умолчанию путем определения значения до включения _*_nx_api.h_*_, например в _ *_nx_user.h_** |
| NX_PHYSICAL_TRAILER | Указывает размер трейлера физического пакета в байтах и обычно используется для резервирования хранилища для таких ресурсов, как значения CRC Ethernet и т. д. Значение по умолчанию равно 4 и определено в файле ***nx_api.h***.|

### <a name="arp-configuration-options"></a>Параметры конфигурации ARP

| Параметр  | Описание  |
|---|---|
|NX_ARP_DEFEND_BY_REPLY | Если определен, этот параметр позволяет NetX Duo защитить свой IP-адрес путем отправки ответа ARP.|
|NX_ARP_DEFEND_INTERVAL| Определяет интервал (в секундах), в течение которого модуль ARP отправляет следующий пакет защиты в ответ на входящее сообщение ARP, которое указывает на конфликт адреса.|
|NX_ARP_DISABLE_AUTO_ARP_ENTRY|  Переименован в ***NX_DISABLE_ARP_AUTO_ENTRY** _. Хотя этот параметр по-прежнему поддерживается, в новых проектах рекомендуется использовать _*_NX_DISABLE_ARP_AUTO_ENTRY_**.|
|NX_ARP_EXPIRATION_RATE| Указывает время в секундах, в течение которого записи ARP остаются действительными. Нулевое значение по умолчанию отключает срок действия или устаревания записей ARP и задается в ***nx_api.h** _. Приложение может переопределить значение по умолчанию путем определения значения до включения _ *_nx_api.h_**.|
|NX_ARP_MAC_CHANGE_NOTIFICATION_ENABLE | Переименован в ***NX_ENABLE_ARP_MAC_CHANGE_NOTIFICATION** _. Хотя этот параметр по-прежнему поддерживается, в новых проектах рекомендуется использовать _*_NX_ENABLE_ARP_MAC_CHANGE_NOTIFICATION_**.|
|NX_ARP_MAX_QUEUE_DEPTH | Указывает максимальное количество пакетов, которые можно поставить в очередь во время ожидания ответа ARP. Значение по умолчанию равно 4 и определено в ***nx_api.h***.|
|NX_ARP_MAXIMUM_RETRIES | Указывает максимальное количество повторных попыток ARP без ответа ARP. Значение по умолчанию равно 18 и определено в ***nx_api.h** _. Приложение может переопределить значение по умолчанию путем определения значения до включения _ *_nx_api.h_**.|
|NX_ARP_UPDATE_RATE | Указывает время в секундах между повторными попытками ARP. Значение по умолчанию равно 10, что соответствует 10 секундам, и определяется в файле ***nx_api.h** _. Приложение может переопределить значение по умолчанию путем определения значения до включения _ *_nx_api.h_**.|
|NX_DISABLE_ARP_AUTO_ENTRY | Если определен, этот параметр отключает ввод данных запроса ARP в кэш ARP.|
|NX_DISABLE_ARP_INFO | Если определен, этот параметр отключает сбор данных ARP.|
|NX_ENABLE_ARP_MAC_CHANGE_NOTIFICATION| Если определен, этот параметр разрешает ARP вызывать функцию уведомления обратного вызова при обнаружении изменения MAC-адреса.|

### <a name="icmp-configuration-options"></a>Параметры конфигурации ICMP

| Параметр  | Описание  |
|---|---|
|NX_DISABLE_ICMP_INFO| Если определен, этот параметр отключает сбор данных ICMP.|
|NX_DISABLE_ICMP_RX_CHECKSUM| Если определен, этот параметр отключает вычисление контрольных сумм ICMPv4 и ICMPv6 для полученных пакетов ICMP. Этот параметр полезен, если драйвер сетевого интерфейса способен проверить контрольную сумму ICMPv4 и ICMPv6, и приложение не использует возможность фрагментации IP или IPsec. По умолчанию этот параметр не определен.|
|NX_DISABLE_ICMP_TX_CHECKSUM | Если определен, этот параметр отключает вычисление контрольных сумм ICMPv4 и ICMPv6 для передаваемых пакетов ICMP. Этот параметр полезен, если драйвер сетевого интерфейса способен вычислить контрольную сумму ICMPv4 и ICMPv6,
а приложение не использует возможность фрагментации IP-адресов или IPsec. По умолчанию этот параметр не определен.|
|NX_DISABLE_ICMPV4_ERROR_MESSAGE | Если этот параметр определен, NetX Duo не отправляет сообщения об ошибках ICMPv4 в ответ на такие ошибки, как неверно отформатированный заголовок IPv4. По умолчанию этот параметр не определен.|
|NX_DISABLE_ICMPV4_RX_CHECKSUM | Если определен, этот параметр отключает вычисление контрольной суммы ICMPv4 для полученных пакетов ICMP. Этот параметр определяется автоматически, если определен параметр ***NX_DISABLE_ICMP_RX_CHECKSUM***. По умолчанию этот параметр не определен.|
|NX_DISABLE_ICMPv4_RX_CHECKSUM | Переименован в ***NX_DISABLE_ICMPV4_RX_CHECKSUM** _. Хотя этот параметр по-прежнему поддерживается, в новых проектах рекомендуется использовать _*_NX_DISABLE_ICMPV4_RX_CHECKSUM_**.|
|NX_DISABLE_ICMPV4_TX_CHECKSUM | Если определен, этот параметр отключает вычисление контрольной суммы ICMPv4 для передаваемых пакетов ICMP. Этот параметр определяется автоматически, если определен параметр ***NX_DISABLE_ICMP_TX_CHECKSUM***. По умолчанию этот параметр не определен.|
|NX_DISABLE_ICMPv4_TX_CHECKSUM | Переименован в ***NX_DISABLE_ICMPV4_TX_CHECKSUM** _.</br>Хотя этот параметр по-прежнему поддерживается, в новых проектах рекомендуется использовать _*_NX_DISABLE_ICMPV4_TX_CHECKSUM_**.|
|NX_ENABLE_ICMP_ADDRESS_CHECK | Если определить этот параметр, будет выполнятся проверка адреса назначения пакета ICMP. По умолчанию — отключен. Запрос на проверку связи ICMP, предназначенный для широковещательного IP-адреса или IP-адреса многоадресной рассылки, будет автоматически отклонен.|

### <a name="igmp-configuration-options"></a>Параметры конфигурации IGMP

| Параметр  | Описание  |
|---|---|
|NX_DISABLE_IGMP_INFO | Если определен, этот параметр отключает сбор данных IGMP.|
|NX_DISABLE_IGMPV2 | Если определен, этот параметр отключает поддержку IGMPv2, и NetX Duo будет поддерживать только IGMPv1. По умолчанию этот параметр не задан и определяется в ***nx_api.h***.|
|NX_MAX_MULTICAST_GROUPS | Указывает максимальное число групп многоадресной рассылки, которые можно объединить. Значение по умолчанию равно 7 и определено в ***nx_api.h** _. Приложение может переопределить значение по умолчанию путем определения значения до включения _ *_nx_api.h_**.|

### <a name="ip-configuration-options"></a>Параметры конфигурации IP

| Параметр  | Описание  |
|---|---|
|NX_DISABLE_FRAGMENTATION | Если определен, этот параметр отключает фрагментацию IPv4 и IPv6 и логику повторной сборки.|
| NX_DISABLE_IPV4     | Если определен, этот параметр отключает функцию IPv4. Этот параметр можно использовать для сборки NetX Duo таким образом, чтобы система поддерживала только IPv6. По умолчанию этот параметр не определен. |
| NX_DISABLE_IP_INFO | Если определен, этот параметр отключает сбор данных IP.|
|NX_DISABLE_IP_RX_CHECKSUM | Если определен, этот параметр отключает логику вычисления контрольной суммы для полученных пакетов IPv4. Это полезно, если сетевое устройство может проверять контрольную сумму IPv4, и приложение не будет использовать фрагментацию IP-адресов или IPsec.|
|NX_DISABLE_IP_TX_CHECKSUM | Если определен, этот параметр отключает логику вычисления контрольной суммы для отправленных пакетов IPv4. Это полезно в ситуациях, когда базовое сетевое устройство может создавать контрольную сумму заголовка IPv4, и приложение не будет использовать фрагментацию IP или IPsec.|
|NX_DISABLE_LOOPBACK_INTERFACE | Если определен, этот параметр отключает поддержку NetX Duo для интерфейса замыкания на себя.|
|NX_DISABLE_RX_SIZE_CHECKING | Если определен, этот параметр отключает проверку размера полученных пакетов.|
|NX_ENABLE_IP_RAW_PACKET_FILTER | Если определен, этот параметр включает функцию фильтрации при получении необработанных пакетов IP. Эту возможность полезно использовать приложениям, которым нужен дополнительный контроль над типом полученных необработанных пакетов IP. Возможность фильтрации необработанных пакетов IP также поддерживает операцию использования сокета прямого доступа на уровне совместимости BSD. По умолчанию этот параметр не определен.|
|NX_ENABLE_IP_STATIC_ROUTING | Если определен, этот параметр включает статическую маршрутизацию IPv4, в которой адресу назначения можно назначить определенный адрес следующего прыжка. По умолчанию статическая маршрутизация IPv4 отключена.|
|NX_FRAGMENT_IMMEDIATE_ASSEMBLY | Если определен, этот параметр разрешает логике повторной сборки IPv4 и IPv6 выполнятся сразу после получения фрагмента IP. По умолчанию этот параметр не определен.|
|NX_IP_MAX_REASSEMBLY_TIME | Символ, управляющий максимальным временем, разрешенным для повторной сборки фрагмента IPv4 и фрагмента IPv6. Обратите внимание, что заданное здесь значение перезаписывает как ***NX_IPV4_MAX_REASSEMBLY_TIME** _, так и _*_NX_IPV6_MAX_REASSEMBLY_TIME_**.|
|NX_IP_PERIODIC_RATE | Если определен, этот параметр задает количество тактов таймера ThreadX за одну секунду. Значение по умолчанию является производным от символа ThreadX ***TX_TIMER_TICKS_PER_SECOND** _, который по умолчанию имеет значение 100 (таймер 10 мс). При изменении этого значения в приложении необходимо соблюдать осторожность, так как остальные модули NetX Duo наследуют сведения о времени из *_NX_IP_PERIODIC_RATE_.* *|
|NX_IP_RAW_MAX_QUEUE_DEPTH | Символ, управляющий количеством необработанных пакетов IP, которые можно помещать в очередь получения необработанных пакетов. По умолчанию задано значение 20.| 
|NX_IP_ROUTING_TABLE_SIZE | Если определен, этот параметр задает максимальное количество записей в таблице статической маршрутизации IPv4, которое представляет собой список исходящих интерфейсов и адресов следующего прыжка для заданного адреса назначения. Значение по умолчанию равно 8 и определено в ***nx_api.h.** _. Этот символ используется только в том случае, если определен параметр _ *_NX_ENABLE_IP_STATIC_ROUTING_**.|
|NX_IPV4_MAX_REASSEMBLY_TIME | Символ, управляющий максимальным временем, разрешенным для повторной сборки фрагмента IPv4. Обратите внимание, что значение, определенное в NX_IP_MAX_REASSEMBLY_TIME перезаписывает это значение.|

### <a name="packet-configuration-options"></a>Параметры конфигурации пакетов

| Параметр  | Описание  |
|---|---|
|NX_DISABLE_PACKET_CHAIN | Если определен, этот параметр отключает логику цепочки пакетов. По умолчанию этот параметр не определен.|
|NX_DISABLE_PACKET_INFO | Если определен, этот параметр отключает сбор сведений о пуле пакетов.|
|NX_ENABLE_LOW_WATERMARK | Если определен, этот параметр включает возможность задания нижнего предела пула пакетов NetX Duo. Приложение устанавливает значение нижнего предела. Если при получении пакетов TCP достигается нижний предел пула пакетов, NetX Duo автоматически отклоняет пакет, освобождая его, и таким образом предотвращая зависание пула пакетов. По умолчанию эта возможность отключена.|
|NX_ENABLE_PACKET_DEBUG_INFO | Если определен, этот параметр записывает сведения об отладке пакетов.|
|NX_PACKET_ALIGNMENT | Если определен, этот параметр задает требование к выравниванию в байтах для начального адреса области полезных данных пакета. Этот параметр исключает возможность использования параметров ***NX_PACKET_HEADER_PAD** _ и _*_NX_PACKET_HEADER_PAD_SIZE_**. По умолчанию этот параметр имеет значение 4, что делает начальный адрес области полезной нагрузки 4-байтовым.|
|NX_PACKET_HEADER_PAD | Если определен, этот параметр включает заполнение до конца блока управления NX_PACKET. Количество слов ULONG для заполнения определяется параметром ***NX_PACKET_HEADER_PAD_SIZE** _. Обратите внимание, что на возможность использования этого параметр влияет параметр _*_NX_PACKET_ALIGNMENT_**.|
|NX_PACKET_HEADER_PAD_SIZE | Задает количество слов ULONG, которые должны быть заполнены структурой NX_PACKET, позволяя области полезных данных пакета начинаться с нужного выравнивания. Эта функция полезна, когда дескрипторы приема буферов указывают непосредственно на область полезных данных NX_PACKET, а логика приема сетевого интерфейса или логика операций кэша ожидает, что начальный адрес буфера будет соответствовать определенным требованиям к выравниванию. Это значение допустимо, только если определен параметр ***NX_PACKET_HEADER_PAD** _. Обратите внимание, что на возможность использования этого параметр влияет параметр _*_NX_PACKET_ALIGNMENT_**.|

### <a name="rarp-configuration-options"></a>Параметры конфигурации RARP

| Параметр  | Описание  |
|---|---|
|NX_DISABLE_RARP_INFO | Если определен, этот параметр отключает сбор данных RARP.|

### <a name="tcp-configuration-options"></a>Параметры конфигурации TCP

| Параметр | Описание |
|---|---|
|NX_DISABLE_RESET_DISCONNECT | Если определен, этот параметр отключает обработку сброса во время отключения, если предоставленное значение времени ожидания указано как ***NX_NO_WAIT***.|
|NX_DISABLE_TCP_INFO | Если определен, этот параметр отключает сбор данных TCP.|
|NX_DISABLE_TCP_RX_CHECKSUM | Если определен, этот параметр отключает логику обработки контрольных сумм для полученных пакетов TCP. Это полезно только в ситуациях, когда канальный уровень имеет надежную обработку контрольных сумм или CRC, или драйвер интерфейса может проверить контрольную сумму TCP на оборудовании, и приложение не использует IPsec.|
|NX_DISABLE_TCP_TX_CHECKSUM | Если определен, этот параметр отключает логику обработки контрольных сумм для отправки пакетов TCP. Это полезно только в ситуациях, если логика обработки контрольных сумм TCP принимающего узла сети отключена или если базовый драйвер сети способен создавать контрольную сумму TCP, и приложение не использует IPsec.|
|NX_ENABLE_TCP_KEEPALIVE | Если определен, этот параметр включает дополнительный таймер проверки активности TCP. Параметры по умолчанию не включены.|
|NX_ENABLE_TCP_MSS_CHECK | Если определен, этот параметр включает проверку минимального значения MSS однорангового узла, прежде чем принимать подключение по TCP. Чтобы использовать эту возможность, необходимо определить символ ***NX_ENABLE_TCP_MSS_MINIMUM***. По умолчанию этот параметр отключен.|
|NX_ENABLE_TCP_QUEUE_DEPTH_UPDATE_NOTIFY| Если определен, этот параметр позволяет приложению устанавливать функцию обратного вызова, вызываемую, когда длина очереди передачи TCP больше опускается ниже максимально допустимого значения. Этот обратный вызов служит для указания того, что сокет TCP готов к передаче дополнительных данных. По умолчанию этот параметр отключен.|
|NX_ENABLE_TCP_WINDOW_SCALING | Включает параметр масштабирования окна для приложений TCP. Если определить этот параметр, параметр масштабирования окна согласовывается на этапе подключения по TCP, и приложение может указать размер окна, превышающий 64 КБ. Параметр по умолчанию не включен (не определен).|
|NX_MAX_LISTEN_REQUESTS | Указывает максимальное число запросов на прослушивание сервера. Значение по умолчанию равно 10 и определено в ***nx_api.h** _. Приложение может переопределить значение по умолчанию путем определения значения до включения _ *_nx_api.h_**.|
|NX_TCP_ACK_EVERY_N_PACKETS | Указывает количество пакетов TCP, которые нужно получить перед отправкой ACK. Обратите внимание, что если параметр ***NX_TCP_IMMEDIATE_ACK** _ включен, а _ *_NX_TCP_ACK_EVERY_N_PACKETS_** — нет, для обратной совместимости автоматически устанавливается значение 1.|
|NX_TCP_ACK_TIMER_RATE | Определяет, как делится количество системных тактов (NX_IP_PERIODIC_RATE) для расчета частоты таймера для обработки отложенных подтверждений ACK TCP. Значение по умолчанию равно 5, что соответствует 200 мс, и определяется в ***nx_api.h** _. Приложение может переопределить значение по умолчанию путем определения значения до включения _ *_nx_api.h_**.|
|NX_TCP_ENABLE_KEEPALIVE | Переименован в ***NX_ENABLE_TCP_KEEPALIVE** _. Хотя этот параметр по-прежнему поддерживается, в новых проектах рекомендуется использовать _*_NX_ENABLE_TCP_KEEPALIVE_**.|
|NX_TCP_ENABLE_MSS_CHECK | Переименован в ***NX_ENABLE_TCP_MSS_CHECK** _. Хотя этот параметр по-прежнему поддерживается, в новых проектах рекомендуется использовать _ *_NX_ENABLE_TCP_MSS_CHECK._**|
|NX_TCP_ENABLE_WINDOW_SCALING | Переименован в ***NX_ENABLE_TCP_WINDOW_SCALING** _. Хотя он по-прежнему поддерживается, в новых проектах рекомендуется использовать _*_NX_ENABLE_TCP_WINDOW_SCALING_**.|
|NX_TCP_FAST_TIMER_RATE | Указывает, как число внутренних тактов NetX Duo (NX_IP_PERIODIC_RATE) делится для вычисления скорости быстрого таймера TCP. Быстрый таймер TCP используется для управления различными таймерами TCP, в том числе таймером отложенного подтверждения ACK. Значение по умолчанию равно 10, что соответствует 100 мс, при условии, что таймер ThreadX работает на 10 мс. Это значение определяется в ***nx_tcp.h** _. Приложение может переопределить значение по умолчанию путем определения значения до включения _ *_nx_api.h_**.|
|NX_TCP_IMMEDIATE_ACK| Если определен, этот параметр включает необязательную немедленную обработку ответа ACK TCP. Определение этого символа эквивалентно определению ***NX_TCP_ACK_EVERY_N_PACKETS*** в значение 1.|
|NX_TCP_KEEPALIVE_INITIAL | Указывает число секунд бездействия до активации таймера проверки активности. Значение по умолчанию равно 7200, что соответствует 2 часам, и определяется в ***nx_tcp.h** _. Приложение может переопределить значение по умолчанию путем определения значения до включения _ *_nx_api.h_**.|
|NX_TCP_KEEPALIVE_RETRIES | Указывает, сколько попыток проверки активности разрешено, прежде чем соединение будет считаться неработающим. Значение по умолчанию равно 10, что соответствует 10 попыткам, и определяется в ***nx_api.h** _. Приложение может переопределить значение по умолчанию путем определения значения до включения _ *_nx_api.h_**.|
|NX_TCP_KEEPALIVE_RETRY | Указывает время в секундах между повторными попытками таймера проверки активности в случае, если другая сторона соединения не отвечает. Значение по умолчанию равно 75, что соответствует 75 секундам, и определяется в ***nx_tcp.h** _. Приложение может переопределить значение по умолчанию путем определения значения до включения _ *_nx_api.h_**.|
|NX_TCP_MAX_OUT_OF_ORDER_PACKETS | Символ, который определяет максимальное число неупорядоченных пакетов TCP, которые могут храниться в очереди приема сокета TCP. Этот символ можно использовать для ограничения количества пакетов, помещенных в очередь приема сокета TCP, предотвращая зависание пула пакетов. По умолчанию этот символ не определен, поэтому количество неупорядоченных пакетов, помещенных в очередь сокета TCP, не ограничено.|
|NX_TCP_MAXIMUM_RETRIES | Указывает, сколько попыток передачи данных разрешено, прежде чем соединение будет считаться неработающим. Значение по умолчанию равно 10, что соответствует 10 попыткам, и определяется в ***nx_api.h** _. Приложение может переопределить значение по умолчанию путем определения значения до включения _ *_nx_api.h_**.|
|NX_TCP_MAXIMUM_RX_QUEUE | Символ, определяющий максимальную очередь получения сокетов TCP. Эта возможность включается параметром ***NX_ENABLE_LOW_WATERMARK***.|
|NX_TCP_MAXIMUM_TX_QUEUE | Указывает максимальную длину очереди передачи TCP до приостановки или отклонения запросов на отправку TCP. Значение по умолчанию равно 20. Это означает, что в любой конкретный момент времени в очереди передачи может быть не более 20 пакетов. Обратите внимание, что пакеты остаются в очереди передачи до тех пор, пока не будет получено подтверждение ACK о получении некоторых или всех данных пакетов от другой стороны соединения. Эта константа определена в ***nx_tcp.h** _. Приложение может переопределить значение по умолчанию путем определения значения до включения _ *_nx_api.h_**.|
|NX_TCP_MSS_MINIMUM | Символ, который определяет минимальное значение MSS, принимаемое модулем TCP NetX Duo. Эту возможность включает параметр ***NX_ENABLE_TCP_MSS_CHECK***.|
|NX_TCP_QUEUE_DEPTH_UPDATE_NOTIFY_ENABLE | Переименован в ***NX_ENABLE_TCP_QUEUE_DEPTH_UPDATE_NOTIFY** _. Хотя этот параметр по-прежнему поддерживается, в новых проектах рекомендуется использовать _*_NX_ENABLE_TCP_QUEUE_DEPTH_UPDATE_NOTIFY_**.|
|NX_TCP_RETRY_SHIFT | Указывает, как изменяется период ожидания повторной передачи между повторными попытками. Если это значение равно 0, начальное время ожидания повторной передачи будет таким же, как и последующие периоды ожидания повторных отправлений. Если это значение равно 1, каждое последующее ожидание повторной передачи будет вдвое дольше. Если это значение равно 2, время ожидания каждой последующей повторной передачи будет в четыре раза больше. Значение по умолчанию равно 0 и определено в ***nx_tcp.h** _. Приложение может переопределить значение по умолчанию путем определения значения до включения _ *_nx_api.h_**.|
|NX_TCP_TRANSMIT_TIMER_RATE | Определяет, как делится количество системных тактов (***NX_IP_PERIODIC_RATE** _) для расчета частоты таймера для обработки повторных попыток передачи TCP. Значение по умолчанию равно 1, что соответствует 1 секунде, и определяется в файле _*_nx_tcp.h_*_. Приложение может переопределить значение по умолчанию путем определения значения до включения _ *_nx_api.h_**.|

### <a name="udp-configuration-options"></a>Параметры конфигурации UDP

| Параметр  | Описание  |
|---|---|
|NX_DISABLE_UDP_INFO | Если определен, этот параметр отключает сбор данных UDP.|
|NX_DISABLE_UDP_RX_CHECKSUM | Если определен, этот параметр отключает вычисление контрольной суммы UDP для входящих пакетов UDP. Это полезно, если драйвер сетевого интерфейса способен проверить контрольную сумму заголовка UDP в оборудовании, а приложение не включает IPsec или логику фрагментации IP.|
|NX_DISABLE_UDP_TX_CHECKSUM | Если определен, этот параметр отключает вычисление контрольной суммы UDP для исходящих пакетов UDP. Это полезно, если драйвер сетевого интерфейса может вычислять контрольную сумму заголовка UDP и вставлять значение в заголовок IP перед передачей данных, а приложение не включает IPsec или логику фрагментации IP.|

### <a name="ipv6-options"></a>Параметры IPv6  

| Параметр  | Описание  |
|---|---|
| NX_DISABLE_IPV6 | Отключает функции IPv6 при создании библиотеки NetX Duo. Этот параметр позволяет приложениям, которым не требуется протокол IPv6, избежать извлечения в код и необходимости в дополнительном дисковом пространстве для поддержки IPv6.|
|NX_DISABLE_IPV6_PATH_MTU_DISCOVERY | Если определен, этот параметр отключает обнаружение MTU пути, которое используется для определения максимального значения MTU в пути к целевому объекту в таблице назначения узла NetX Duo. Это позволяет узлу NetX Duo отправить самый крупный пакет, который не требует фрагментации. По умолчанию этот параметр определен (значение MTU пути отключено).|
|NX_ENABLE_IPV6_ADDRESS_CHANGE_NOTIFY | Если определен, этот параметр позволяет вызывать функцию обратного вызова при изменении адреса IPv6. По умолчанию этот параметр отключен.|
|NX_ENABLE_IPV6_MULTICAST | Если определен, этот параметр включает функцию присоединения к многоадресной рассылке IPv6 и выход из нее. По умолчанию этот параметр отключен.|
|NX_ENABLE_IPV6_PATH_MTU_DISCOVERY | Если определен, этот параметр включает возможность обнаружения MTU пути IPv6. По умолчанию этот параметр отключен.|
|NX_IPV6_ADDRESS_CHANGE_NOTIFY_ENABLE | Переименован в ***NX_ENABLE_IPV6_ADDRESS_CHANGE_NOTIFY** _. Хотя этот параметр по-прежнему поддерживается, в новых проектах рекомендуется использовать _*_NX_ENABLE_IPV6_ADDRESS_CHANGE_NOTIFY_**.|
|NX_IPV6_DEFAULT_ROUTER_TABLE_SIZE | Указывает количество записей в таблице маршрутизации IPv6. Для маршрутизатора по умолчанию требуется хотя бы одна из этих записей. Этот параметр определяется в ***nx_api.h***, и имеет значение по умолчанию 8.|
|NX_IPV6_DESTINATION_TABLE_SIZE | Указывает количество записей в таблице назначения IPv6. Здесь хранятся сведения об адресах следующего прыжка для IPv6-адресов. Этот параметр определяется в ***nx_api.h***, и имеет значение по умолчанию 8.|
|NX_IPV6_MAX_REASSEMBLY_TIME | Символ, управляющий максимальным временем, разрешенным для повторной сборки фрагмента IPv6.|
|NX_IPV6_MULTICAST_ENABLE | Переименован в ***NX_ENABLE_IPV6_MULTICAST** _. Хотя этот параметр по-прежнему поддерживается, в новых проектах рекомендуется использовать _*_NX_ENABLE_IPV6_MULTICAST_**.|
|NX_IPV6_PREFIX_LIST_TABLE_SIZE | Указывает размер таблицы префиксов. Сведения о префиксе поступают из объявлений маршрутизатора и являются частью конфигурации IPv6-адресов. Этот параметр определяется в ***nx_api.h***, и имеет значение по умолчанию 8.|
|NX_IPV6_STATELESS_AUTOCONFIG_CONTROL | Если определен, этот параметр позволяет NetX Duo отключить возможность автоматической настройки адресов без отслеживания состояния. По умолчанию этот параметр отключен.|
|NX_MAX_IPV6_ADDRESSES | Указывает количество записей в пуле адресов IPv6. Во время настройки интерфейса NetX Duo использует записи IPv6 из пула. Значение по умолчанию (NX_MAX_PHYSICAL_INTERFACES \* 3) позволяет каждому интерфейсу иметь по крайней мере один локальный адрес канала и два глобальных адреса. Обратите внимание, что все интерфейсы используют пул адресов IPv6.|
|NX_PATH_MTU_INCREASE_WAIT_INTERVAL | Задает интервал ожидания в тактах таймера до сброса MTU пути для определенного целевого объекта в таблице назначения. Если определен ***NX_DISABLE_IPV6_PATH_MTU_DISCOVERY***, определение этого символа не будет действовать.|
|NX_PATH_MTU_INCREASE_WAIT_INTERVAL | Символ, указывающий интервал ожидания (в секундах) до сброса значения MTU пути для записи таблицы назначения. Он действителен, только если определен параметр ***NX_ENABLE_IPV6_PATH_MTU_DISCOVERY***. По умолчанию это значение равно 600 секундам.|

### <a name="neighbor-cache-configuration-options"></a>Параметры конфигурации кэша соседей

| Параметр  | Описание  |
|---|---|
|NX_DELAY_FIRST_PROBE_TIME | Указывает задержку в секундах до отправки первого запроса записи кэша в состоянии STALE. Этот параметр определен в ***nx_nd_cache.h***, значение по умолчанию — 5.|
|NX_DISABLE_IPV6_DAD | Этот параметр позволяет отключить обнаружение повторяющихся адресов (DAD) во время назначения адресов IPv6. Адреса задаются вручную либо с помощью автоматической настройки адресов без отслеживания состояния.|
|NX_DISABLE_IPV6_PURGE_UNUSED_CACHE_ENTRIES | Если определен, этот параметр предотвращает удаление NetX Duo старых записей таблицы кэша до истечения времени ожидания, чтобы освободить место для новых записей при заполнении таблицы. Статические записи и записи маршрутизатора не удаляются.|
|NX_IPV6_DAD_TRANSMITS | Указывает число сообщений запроса на опрос соседей, которые нужно отправить, прежде чем NetX Duo отметит адрес интерфейса как допустимый. Если определен ***NX_DISABLE_IPV6_DAD** _ (DAD отключен), установка этого параметра не окажет влияния. Как вариант нулевое значение (0) отключит DAD, но оставит функцию DAD в NetX Duo. Этот параметр определяется в _*_nx_api.h_**, значение по умолчанию — 3.|
|NX_IPV6_DISABLE_PURGE_UNUSED_CACHE_ENTRIES | Переименован в ***NX_DISABLE_IPV6_PURGE_UNUSED_CACHE_ENTRIES** _. Хотя этот параметр по-прежнему поддерживается, в новых проектах рекомендуется использовать _*_NX_DISABLE_IPV6_PURGE_UNUSED_CACHE_ENTRIES_**.|
|NX_IPV6_NEIGHBOR_CACHE_SIZE | Указывает количество записей в таблице кэша соседей IPv6. Этот параметр определен в ***nx_nd_cache.h***, значение по умолчанию — 16.|
|NX_MAX_MULTICAST_SOLICIT | Указывает количество сообщений запроса на опрос соседей, передаваемых NetX Duo в рамках протокола обнаружения соседей IPv6, если требуется сопоставление между адресами IPv6 и MAC. Этот параметр определен в ***nx_nd_cache.h***, значение по умолчанию — 3.|
|NX_MAX_UNICAST_SOLICIT | Указывает количество сообщений запроса на опрос соседей, передаваемых NetX Duo для определения достижимости конкретного соседа. Этот параметр определен в ***nx_nd_cache.h***, значение по умолчанию — 3.|
|NX_ND_MAX_QUEUE_DEPTH | Символ, определяющий максимальное количество пакетов, поставленных в очередь для разрешения кэша ND. По умолчанию для этого символа задано значение 4.|
|NX_REACHABLE_TIME | Указывает время ожидания в секундах, в течение которого запись кэша будет существовать в состоянии REACHABLE, не получая пакеты из адреса IPv6 назначения кэша. Этот параметр определен в ***nx_nd_cache.h***, значение по умолчанию — 30.|
|NX_RETRANS_TIMER  | Указывает продолжительность задержки (в миллисекундах) между пакетами запроса, отправляемыми NetX Duo. Этот параметр определен в ***nx_nd_cache.h***, значение по умолчанию — 1000.|
| NXDUO_DISABLE_DAD | Переименован в ***NX_DISABLE_IPV6_DAD** _. Хотя этот параметр по-прежнему поддерживается, в новых проектах рекомендуется использовать _*_NX_DISABLE_IPV6_DAD_**.|
|NXDUO_DUP_ADDR_DETECT_TRANSMITS | Переименован в ***NX_IPV6_DAD_TRANSMITS** _. Хотя этот параметр по-прежнему поддерживается, в новых проектах рекомендуется использовать _*_NX_IPV6_DAD_TRANSMITS_**.|

### <a name="miscellaneous-icmpv6-configuration-options"></a>Различные параметры конфигурации ICMPv6

| Параметр  | Описание  |
|---|---|
|NX_DISABLE_ICMPV6_ERROR_MESSAGE | Если определен, этот параметр не позволяет NetX Duo отправлять сообщения об ошибке ICMPv6 в ответ на пакет с ошибками (например, если заголовок неверно отформатирован или тип заголовка пакета устарел), полученный с другого узла.|
|NX_DISABLE_ICMPV6_REDIRECT_PROCESS | Если определен, этот параметр отключает обработку пакетов перенаправления ICMPv6. NetX Duo по умолчанию обрабатывает сообщения о перенаправлении и обновляет таблицу назначения с помощью данных IP-адреса следующего прыжка.|
|NX_DISABLE_ICMPV6_ROUTER_ADVERTISEMENT_PROCESS | Если определен, этот параметр не позволяет NetX Duo обрабатывать данные, полученные в пакетах объявления маршрутизатора IPv6.|
|NX_DISABLE_ICMPV6_ROUTER_SOLICITATION | Если определен, этот параметр не позволяет NetX Duo отправлять маршрутизатору сообщения запроса маршрутизатора IPv6 через равные интервалы времени.|
|NX_DISABLE_ICMPV6_RX_CHECKSUM | Если определен, этот параметр отключает вычисление контрольной суммы ICMPv6 для полученных пакетов ICMP.|
|NX_DISABLE_ICMPv6_RX_CHECKSUM | Переименован в ***NX_DISABLE_ICMPV6_RX_CHECKSUM** _. Хотя этот параметр по-прежнему поддерживается, в новых проектах рекомендуется использовать _*_NX_DISABLE_CMPV6_RX_CHECKSUM_**.|
|NX_DISABLE_ICMPV6_TX_CHECKSUM | Если определен, этот параметр отключает вычисление контрольных сумм ICMPv6 для передаваемых пакетов ICMP.|
|NX_DISABLE_ICMPV6_TX_CHECKSUM | Переименован в ***NX_DISABLE_ICMPV6_TX_CHECKSUM** _. Хотя этот параметр по-прежнему поддерживается, в новых проектах рекомендуется использовать _*_NX_DISABLE_ICMPV6_TX_CHECKSUM_**.|
|NX_ICMPV6_MAX_RTR_SOLICITATIONS | Определяет максимальное количество запросов маршрутизатора, отправляемых узлом до получения ответа от маршрутизатора. Если ответа нет, узел предполагает, что маршрутизатор не работает. Значение по умолчанию равно 3.|
|NX_ICMPV6_RTR_SOLICITATION_DELAY | Указывает максимальную задержку для начального запроса маршрутизатора в секундах.|
|NX_ICMPV6_RTR_SOLICITATION_INTERVAL | Указывает интервал между двумя сообщениями запроса маршрутизатора. Значение по умолчанию — 4.|
|NXDUO_DESTINATION_TABLE_SIZE | Переименован в ***NX_IPV6_DESTINATION_TABLE_SIZE** _. Хотя этот параметр по-прежнему поддерживается, в новых проектах рекомендуется использовать _*_NX_IPV6_DESTINATION_TABLE_SIZE_**.|
|NXDUO_DISABLE_ICMPV6_ERROR_MESSAGE | Переименован в ***NX_DISABLE_ICMPV6_ERROR_MESSAGE** _. Хотя этот параметр по-прежнему поддерживается, в новых проектах рекомендуется использовать _*_NX_DISABLE_ICMPV6_ERROR_MESSAGE_**.|
|NXDUO_DISABLE_ICMPV6_REDIRECT_PROCESS | Переименован в ***NX_DISABLE_ICMPV6_REDIRECT_PROCESS** _. Хотя этот параметр по-прежнему поддерживается, в новых проектах рекомендуется использовать _ *_NX_DISABLE_ICMPV6_REDIRECT_PROCESS_**|  
|NXDUO_DISABLE_ICMPV6_ROUTER_ADVERTISEMENT_PROCESS| Переименован в ***NX_DISABLE_ICMPV6_ROUTER_ADVERTISEMENT_PROCESS** _. Хотя этот параметр по-прежнему поддерживается, в новых проектах рекомендуется использовать _*_NX_DISABLE_ICMPV6_ROUTER_ADVERTISEMENT_PROCESS_**.|
|NXDUO_DISABLE_ICMPV6_ROUTER_SOLICITATION | Переименован в ***NX_DISABLE_ICMPV6_ROUTER_SOLICITATION** _. Хотя этот параметр по-прежнему поддерживается, в новых проектах рекомендуется использовать _*_NX_DISABLE_ICMPV6_ROUTER_SOLICITATION_**.|
|NXDUO_ICMPV6_MAX_RTR_SOLICITATIONS | Переименован в ***NX_ICMPV6_MAX_RTR_SOLICITATIONS** _. Хотя этот параметр по-прежнему поддерживается, в новых проектах рекомендуется использовать _*_NX_ICMPV6_MAX_RTR_SOLICITATIONS_**.|
|NXDUO_ICMPV6_RTR_SOLICITATION_INTERVAL | Переименован в ***NX_ICMPV6_RTR_SOLICITATION_INTERVAL** _. Этот символ является устаревшим. Хотя он по-прежнему поддерживается, в новых проектах рекомендуется использовать _ *_NX_ICMPV6_RTR_SOLICITATION_INTERVAL_**|

## <a name="netx-duo-version-id"></a>Идентификатор версии NetX Duo

Сведения о текущей версии NetX Duo доступны во время выполнения как пользователю, так и ПО приложения. Версию NetX Duo можно узнать, изучив файл **nx_port.h**. Кроме того, этот файл содержит журнал версий для соответствующего порта. Программное обеспечение приложения может получить сведения о версии NetX Duo из глобальной строки _**_nx_version_id_*_ в файле _*_nx_port.h_**.

Программное обеспечение приложения также может получать сведения о выпуске из приведенных ниже констант, которые определены в файле ***nx_api.h***.

Эти константы определяют выпуск текущего продукта по имени, а также основную и дополнительную версии продукта.

\#define EL_PRODUCT_NETXDUO  
\#define NETXDUO_MAJOR_VERSION  
\#define NETXDUO_MINOR_VERSION