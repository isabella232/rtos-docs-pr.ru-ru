---
title: Глава 1. Введение в DHCP-сервер NetX Duo для ОСРВ Azure
description: В NetX Duo IP-адрес приложения является одним параметров, указываемых в вызове функции *nx_ip_create*.
author: philmea
ms.author: philmea
ms.date: 06/08/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: a56f692059cbd3e2a72d64cf80ee90a917b80987add8130d3a1df70b3b0c3a71
ms.sourcegitcommit: 93d716cf7e3d735b18246d659ec9ec7f82c336de
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2021
ms.locfileid: "116788479"
---
# <a name="chapter-1---introduction-to-azure-rtos-netx-duo-dhcp-server"></a>Глава 1. Введение в DHCP-сервер NetX Duo для ОСРВ Azure

В NetX Duo IP-адрес приложения является одним параметров, указываемых в вызове функции *nx_ip_create*. Предоставление IP-адреса не вызывает проблем, если этот IP-адрес известен приложению, то есть назначен статически или посредством конфигурации пользователя. Однако существуют ситуации, в которых приложение не знает своего IP-адреса или он не важен. В таких ситуациях необходимо передать нулевой IP-адрес в функцию *nx_ip_create*, а приложению следует подключиться к DHCP-серверу для динамического запроса и получения IP-адреса.

## <a name="dynamic-ip-address-assignment"></a>Динамическое назначение IP-адресов

Основной службой, используемой для получения динамического IP-адреса из сети, является протокол RARP. Этот протокол аналогичен протоколу ARP, за исключением того, что он предназначен для получения IP-адреса для себя, а не для поиска MAC-адреса для другого сетевого узла. Сообщение низкого уровня RARP транслируется по локальной сети, и сервер в этой сети обязан отправить ответ RARP, который содержит динамически выделенный IP-адрес.

Хотя протокол RARP предоставляет службу для динамического выделения IP-адресов, у него есть несколько недостатков. Самый очевидный недостаток заключается в том, что протокол RARP обеспечивает динамическое выделение только IP-адреса. В большинстве случаев для того, чтобы устройство правильно работало в сети, требуется дополнительная информация. В дополнение к IP-адресу большинству устройств требуется маска сети и IP-адрес шлюза. Может также потребоваться IP-адрес DNS-сервера и другие сведения о сети. Протокол RARP не может предоставить эти сведения.

## <a name="rarp-alternatives"></a>Альтернативы протоколу RARP

Чтобы преодолеть недостатки протокола RARP, исследователи разработали более полный механизм выделения IP-адресов, называемый протоколом начальной загрузки (BOOTP). Этот протокол может динамически выделять IP-адреса, а также предоставлять важные дополнительные сведения о сети. Тем не менее недостаток протокола BOOTP заключается в том, что он разработан для статических сетевых конфигураций. Он не позволяет быстро или автоматически назначать адреса.

Именно здесь может оказаться очень полезным протокол DHCP. Протокол DHCP призван расширить основные функции BOOTP, включая полностью автоматизированное выделение IP-серверов и полностью динамическое выделение IP-адресов путем предоставления IP-адреса клиенту "в аренду" на указанный период времени. Протокол DHCP можно также настроить для статического выделения IP-адресов, как в протоколе BOOTP.

## <a name="dhcp-messages"></a>Сообщения DHCP

Хотя протокол DHCP значительно расширяет функции протокола BOOTP, в DHCP используется тот же формат сообщений, что и в BOOTP, и поддерживаются те же варианты поставщиков, что и в BOOTP. Для выполнения функций в протокол DHCP добавлены семь новых параметров, относящихся к DHCP.

- DISCOVER (1) (отправляется DHCP-клиентом);
- OFFER (2) (отправляется DHCP-сервером)
- DISCOVER (3) (отправляется DHCP-клиентом)
- DECLINE (4) (отправляется DHCP-клиентом)
- ACK (5) (отправляется DHCP-сервером)
- NACK (6) (отправляется DHCP-сервером)
- RELEASE (7) (отправляется DHCP-клиентом)
- INFORM (8) (отправляется DHCP-клиентом)
- FORCERENEW (9) (отправляется DHCP-клиентом)

## <a name="dhcp-communication"></a>Взаимодействие по протоколу DHCP

DHCP-сервер использует протокол UDP для получения запросов DHCP-клиентов и передачи ответов. Перед получением IP-адреса выполняются отправка и получение сообщений UDP, в которых хранятся данные DHCP, с помощью широковещательного IP-адреса 255.255.255.255. Но если клиент знает адрес DHCP-сервера, он может отправлять одноадресные сообщения DHCP.

## <a name="dhcp-server-state-machine"></a>Конечный автомат DHCP-сервера

DHCP-сервер реализуется в виде двухэтапного конечного автомата, выполняемого внутренним потоком DHCP, который создается во время обработки *nx_dhcp_server_create*. Основными состояниями DHCP-сервера являются получение сообщения DISCOVER от DHCP-клиента и получение сообщения REQUEST.

Ниже приведены соответствующие состояния DHCP-клиента.

- **NX_DHCP_STATE_BOOT**: запуск с предыдущим IP-адресом.
- **NX_DHCP_STATE_INIT**: запуск без предыдущего IP-адреса.
- **NX_DHCP_STATE_SELECTING**: ожидание ответа от любого DHCP-сервера.
- **NX_DHCP_STATE_REQUESTING**: DHCP-сервер определен, отправлен запрос IP-адреса.
- **NX_DHCP_STATE_BOUND**: установлена аренда IP-адреса DHCP.
- **NX_DHCP_STATE_RENEWING**: пришло время продления аренды IP-адреса DHCP, запрошено продление.
- **NX_DHCP_STATE_REBINDING**: пришло время повторной привязки для аренды IP-адреса DHCP, запрошено продление.
- **NX_DHCP_STATE_FORCERENEW**: установлена аренда IP-адреса DHCP, сервером или приложением выполнено принудительное продление.
- **NX_DHCP_STATE_FAILED**: сервер не найден, или не получен ответ от сервера.

## <a name="dhcp-additional-parameters"></a>Дополнительные параметры DHCP

На DHCP-сервере NetX Duo применяется список параметров по умолчанию, которые задаются в настраиваемом параметре NX_DHCP_DEFAULT_SERVER_OPTION_LIST в файле *nxd_dhcp_server.h*. Это позволяет предоставить DHCP-клиентам общие или критические параметры конфигурации сети, например адрес маршрутизатора или шлюза и DNS-сервер для DHCP-клиента.

## <a name="dhcp-rfcs"></a>Документы RFC, которым соответствует протокол DHCP

DHCP-сервер NetX Duo соответствует RFC 2132, RFC 2131 и связанным документам RFC.
