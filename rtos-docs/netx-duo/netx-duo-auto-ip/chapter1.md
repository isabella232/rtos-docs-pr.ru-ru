---
title: Глава 1. Введение в протокол ОСРВ Azure NetX Duo AutoIP
description: AutoIP — это протокол, предназначенный для динамической настройки IPv4-адресов в локальной сети. Для правильной работы пакета ОСРВ Azure NetX Duo AutoIP требуется, чтобы экземпляр NetX IP уже был создан.
author: philmea
ms.author: philmea
ms.date: 06/04/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: 24fb514b71f7812266de23ec6d485dca9769a2bef491fc773a90f9945885f3df
ms.sourcegitcommit: 93d716cf7e3d735b18246d659ec9ec7f82c336de
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2021
ms.locfileid: "116784909"
---
# <a name="chapter-1---introduction-to-azure-rtos-netx-duo-autoip"></a>Глава 1. Введение в протокол ОСРВ Azure NetX Duo AutoIP

AutoIP — это протокол, предназначенный для динамической настройки IPv4-адресов в локальной сети. AutoIP — это простой протокол, который использует возможности протокола ARP для автоматического назначения IP-адресов. Протокол AutoIP выделяет адреса в диапазоне от 169.254.1.0 до 169.254.254.255.

## <a name="autoip-requirements"></a>Требования к протоколу AutoIP

Для правильной работы пакета ОСРВ Azure NetX Duo AutoIP требуется, чтобы экземпляр NetX IP уже был создан. Кроме того, для этого экземпляра IP должен быть включен протокол ARP. Дополнительные требования для пакета NetX AutoIP отсутствуют.

## <a name="autoip-constraints"></a>Ограничения протокола AutoIP

Протокол NetX AutoIP реализует требования стандарта RFC3927. Однако действуют следующие ограничения.

1. Если используется NetX DHCP, то поток DHCP должен быть создан с более высоким приоритетом, чем поток экземпляра NetX IP и поток AutoIP.

1. NetX AutoIP не предоставляет механизм для использования старых IP-адресов.

1. При изменении IP-адреса приложение отвечает за разрыв существующих TCP-подключений и их повторное создание по новому IP-адресу.

## <a name="autoip-protocol-implementation"></a>Реализация протокола AutoIP

Сначала протокол NetX AutoIP выбирает случайный адрес в диапазоне IPv4-адресов AutoIP, от 169.254.1.0 до 169.254.254.255. Кроме того, приложение может принудительно задать начальный IP-адрес, указав его функции ***nx_auto_ip_start***. Это удобно в ситуациях, когда адрес AutoIP был успешно использован в предыдущем запуске.

После выбора адреса AutoIP протокол NetX AutoIP отправляет серии проб ARP на выбранный адрес. Проба ARP состоит из сообщения запроса ARP с адресом отправителя 0.0.0.0 и целевым адресом, в качестве которого задан нужный адрес AutoIP. Отправляется серия проб ARP (их фактическое число определяет параметр NX_AUTO_IP_PROBE_NUM). Если другой сетевой узел отвечает на эту пробу или отправляет идентичную пробу на тот же адрес, то из диапазона IPv4-адресов AutoIP случайным образом выбирается новый адрес AutoIP и выполняется повторная обработка пробы.

Если отправлены NX_AUTO_IP_PROBE_NUM проб без каких-либо ответов, NetX AutoIP отправляет серию объявлений ARP на выбранный адрес. Объявление ARP состоит из сообщения запроса ARP, в котором в качестве адреса отправителя и целевого адреса указан выбранный адрес AutoIP. Отправляется серия сообщений объявления ARP. Количество объявлений в серии определяет параметр NX_AUTO_IP_ANNOUNCE_NUM. Если другой сетевой узел отвечает на сообщение объявления или отправляет идентичное объявление на тот ж адреса, то из диапазона IPv4-адресов AutoIP случайным образом выбирается новый адрес AutoIP и обработка пробы начинается заново.

Если по завершении обработки пробы и объявления конфликты не обнаружены, то выбранный адрес AutoIP считается допустимым и он настраивается для связанного экземпляра IP.

## <a name="autoip-address-change"></a>Изменение адреса AutoIP

Как упоминалось ранее, NetX AutoIP изменяет экземпляр IP после успешной обработки пробы и объявления. В этом случае мониторинг не слишком важен. Однако в будущем адрес AutoIP может быть изменен. К потенциальным причинам относятся будущие конфликты адресов AutoIP, а также разрешение адресов DHCP. Для правильной обработки этих потенциальных ситуаций приложение должно использовать приведенный ниже API NetX для оповещения об изменении любого IP-адреса.

```c
nx_ip_address_change_notify(NX_IP *ip_ptr,
            VOID (*ip_address_change_notify)(NX_IP *,VOID*),
            VOID *additional_info);
```

Логика предоставленной функции *ip_address_change_notify* должна либо перезапустить процессор NetX AutoIP, либо отключить его, если служба DHCP впоследствии разрешила IP-адрес. Пример такой обработки приведен в разделе *Пример небольшой системы*.

## <a name="autoip-rfcs"></a>Документы RFC по протоколу AutoIP

NetX AutoIP соответствует документу RFC 3927 и связанным документам RFC.